<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `memory` mod in crate `kernel_config`."><meta name="keywords" content="rust, rustlang, rust-lang, memory"><title>kernel_config::memory - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css"><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../kernel_config/index.html'><div class='logo-container'><img src='../../rust-logo.png' alt='logo'></div></a><p class='location'>Module memory</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#constants">Constants</a></li></ul></div><p class='location'><a href='../index.html'>kernel_config</a></p><script>window.sidebarCurrent = {name: 'memory', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../src/kernel_config/memory.rs.html#1-102' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../index.html'>kernel_config</a>::<wbr><a class="mod" href=''>memory</a></span></h1><div class='docblock'><p>WARNING: DO NOT USE ANY ADDRESS THAT MAPS TO THE SAME P4 ENTRY AS THE ONE
USED FOR THE RECURSIVE PAGE TABLE ENTRY (CURRENTLY 510). 
Currently, that would be any address that starts with 0xFFFF_FF0*<em>****</em>****,
so do not use that virtual address range for anything!!
Current P4 (top-level page table) mappings:</p>
<ul>
<li>511: kernel text sections</li>
<li>510: recursive mapping to top of P4</li>
<li>509: kernel heap</li>
<li>508: kernel stacks</li>
<li>507: userspace stacks</li>
<li>506 down to 0:  available for user processes</li>
</ul>
</div><h2 id='constants' class='section-header'><a href="#constants">Constants</a></h2>
<table><tr class='module-item'><td><a class="constant" href="constant.ADDRESSABILITY_PER_P4_ENTRY.html" title='kernel_config::memory::ADDRESSABILITY_PER_P4_ENTRY constant'>ADDRESSABILITY_PER_P4_ENTRY</a></td><td class='docblock-short'><p>Value: 512 GiB.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.BYTES_PER_ADDR.html" title='kernel_config::memory::BYTES_PER_ADDR constant'>BYTES_PER_ADDR</a></td><td class='docblock-short'><p>64-bit architecture results in 8 bytes per address.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.ENTRIES_PER_PAGE_TABLE.html" title='kernel_config::memory::ENTRIES_PER_PAGE_TABLE constant'>ENTRIES_PER_PAGE_TABLE</a></td><td class='docblock-short'><p>Value: 512. </p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_HEAP_INITIAL_SIZE.html" title='kernel_config::memory::KERNEL_HEAP_INITIAL_SIZE constant'>KERNEL_HEAP_INITIAL_SIZE</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_HEAP_MAX_SIZE.html" title='kernel_config::memory::KERNEL_HEAP_MAX_SIZE constant'>KERNEL_HEAP_MAX_SIZE</a></td><td class='docblock-short'><p>the kernel heap gets the whole 509th P4 entry.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_HEAP_P4_INDEX.html" title='kernel_config::memory::KERNEL_HEAP_P4_INDEX constant'>KERNEL_HEAP_P4_INDEX</a></td><td class='docblock-short'><p>Value: 509. The 509th entry is used for the kernel heap</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_HEAP_START.html" title='kernel_config::memory::KERNEL_HEAP_START constant'>KERNEL_HEAP_START</a></td><td class='docblock-short'><p>higher-half heap gets 512 GB address range starting at the 509th P4 entry,
which is the slot right below the recursive P4 entry (510)
actual value: 0o177777_775_000_000_000_0000, or 0xFFFF_FE80_0000_0000</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_OFFSET.html" title='kernel_config::memory::KERNEL_OFFSET constant'>KERNEL_OFFSET</a></td><td class='docblock-short'><p>The virtual address where the initial kernel (the nano_core) is mapped to.
Actual value: 0xFFFFFFFF80000000.
i.e., the linear offset between physical memory and kernel memory.
So, for example, the VGA buffer will be mapped from 0xb8000 to 0xFFFFFFFF800b8000.
This is -2GiB from the end of the 64-bit address space.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_STACK_ALLOCATOR_BOTTOM.html" title='kernel_config::memory::KERNEL_STACK_ALLOCATOR_BOTTOM constant'>KERNEL_STACK_ALLOCATOR_BOTTOM</a></td><td class='docblock-short'><p>the kernel stack allocator gets the 508th P4 entry of addressability.
actual value: 0o177777_774_000_000_000_0000, or 0xFFFF_FE00_0000_0000 </p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_STACK_ALLOCATOR_TOP_ADDR.html" title='kernel_config::memory::KERNEL_STACK_ALLOCATOR_TOP_ADDR constant'>KERNEL_STACK_ALLOCATOR_TOP_ADDR</a></td><td class='docblock-short'><p>the highest actually usuable address in the kernel stack allocator</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_STACK_P4_INDEX.html" title='kernel_config::memory::KERNEL_STACK_P4_INDEX constant'>KERNEL_STACK_P4_INDEX</a></td><td class='docblock-short'><p>Value: 508. The 508th entry is used for all kernel stacks</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_STACK_SIZE_IN_PAGES.html" title='kernel_config::memory::KERNEL_STACK_SIZE_IN_PAGES constant'>KERNEL_STACK_SIZE_IN_PAGES</a></td><td class='docblock-short'><p>The size in pages of each kernel stack. 
If it's too small, complex kernel functions will overflow, causing a page fault / double fault.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_TEXT_MAX_SIZE.html" title='kernel_config::memory::KERNEL_TEXT_MAX_SIZE constant'>KERNEL_TEXT_MAX_SIZE</a></td><td class='docblock-short'><p>The size in bytes, not in pages.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_TEXT_P4_INDEX.html" title='kernel_config::memory::KERNEL_TEXT_P4_INDEX constant'>KERNEL_TEXT_P4_INDEX</a></td><td class='docblock-short'><p>Value: 511. The 511th entry is used for kernel text sections</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.KERNEL_TEXT_START.html" title='kernel_config::memory::KERNEL_TEXT_START constant'>KERNEL_TEXT_START</a></td><td class='docblock-short'><p>The kernel text region is where we load kernel modules. 
It starts at the 511th P4 entry and goes up until the KERNEL_OFFSET,
which is where the nano_core itself starts. 
actual value: 0o177777_777_000_000_000_0000, or 0xFFFF_FF80_0000_0000</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.MAX_PAGE_NUMBER.html" title='kernel_config::memory::MAX_PAGE_NUMBER constant'>MAX_PAGE_NUMBER</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.MAX_VIRTUAL_ADDRESS.html" title='kernel_config::memory::MAX_VIRTUAL_ADDRESS constant'>MAX_VIRTUAL_ADDRESS</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.P1_INDEX_SHIFT.html" title='kernel_config::memory::P1_INDEX_SHIFT constant'>P1_INDEX_SHIFT</a></td><td class='docblock-short'><p>Value: 0. Shift the Page number (not the address!) by this to get the P1 index.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.P2_INDEX_SHIFT.html" title='kernel_config::memory::P2_INDEX_SHIFT constant'>P2_INDEX_SHIFT</a></td><td class='docblock-short'><p>Value: 9. Shift the Page number (not the address!) by this to get the P2 index.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.P3_INDEX_SHIFT.html" title='kernel_config::memory::P3_INDEX_SHIFT constant'>P3_INDEX_SHIFT</a></td><td class='docblock-short'><p>Value: 18. Shift the Page number (not the address!) by this to get the P3 index.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.P4_INDEX_SHIFT.html" title='kernel_config::memory::P4_INDEX_SHIFT constant'>P4_INDEX_SHIFT</a></td><td class='docblock-short'><p>Value: 27. Shift the Page number (not the address!) by this to get the P4 index.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.PAGE_SHIFT.html" title='kernel_config::memory::PAGE_SHIFT constant'>PAGE_SHIFT</a></td><td class='docblock-short'><p>The lower 12 bits of a virtual address correspond to the P1 page frame offset. </p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.PAGE_SIZE.html" title='kernel_config::memory::PAGE_SIZE constant'>PAGE_SIZE</a></td><td class='docblock-short'><p>Page size is 4096 bytes, 4KiB pages.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.RECURSIVE_P4_INDEX.html" title='kernel_config::memory::RECURSIVE_P4_INDEX constant'>RECURSIVE_P4_INDEX</a></td><td class='docblock-short'><p>Value: 510. The 510th entry is used for the recursive P4 mapping.</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.TEMPORARY_PAGE_VIRT_ADDR.html" title='kernel_config::memory::TEMPORARY_PAGE_VIRT_ADDR constant'>TEMPORARY_PAGE_VIRT_ADDR</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="constant" href="constant.USER_STACK_ALLOCATOR_BOTTOM.html" title='kernel_config::memory::USER_STACK_ALLOCATOR_BOTTOM constant'>USER_STACK_ALLOCATOR_BOTTOM</a></td><td class='docblock-short'><p>the userspace stack allocators (one per userspace task) each get the 507th P4 entry of addressability.
actual value: 0o177777_773_000_000_000_0000, or 0xFFFF_FD80_0000_0000  </p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.USER_STACK_ALLOCATOR_TOP_ADDR.html" title='kernel_config::memory::USER_STACK_ALLOCATOR_TOP_ADDR constant'>USER_STACK_ALLOCATOR_TOP_ADDR</a></td><td class='docblock-short'><p>the highest actually usuable address in each userspace stack allocator</p>
</td></tr><tr class='module-item'><td><a class="constant" href="constant.USER_STACK_P4_INDEX.html" title='kernel_config::memory::USER_STACK_P4_INDEX constant'>USER_STACK_P4_INDEX</a></td><td class='docblock-short'><p>Value: 507. The 507th entry is used for all userspace stacks</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><aside id="help" class="hidden"><div><h1 class="hidden">Help</h1><div class="shortcuts"><h2>Keyboard Shortcuts</h2><dl><dt><kbd>?</kbd></dt><dd>Show this help dialog</dd><dt><kbd>S</kbd></dt><dd>Focus the search field</dd><dt><kbd>↑</kbd></dt><dd>Move up in search results</dd><dt><kbd>↓</kbd></dt><dd>Move down in search results</dd><dt><kbd>↹</kbd></dt><dd>Switch tab</dd><dt><kbd>&#9166;</kbd></dt><dd>Go to active search result</dd><dt><kbd>+</kbd></dt><dd>Expand all sections</dd><dt><kbd>-</kbd></dt><dd>Collapse all sections</dd></dl></div><div class="infos"><h2>Search Tricks</h2><p>Prefix searches with a type followed by a colon (e.g., <code>fn:</code>) to restrict the search to a given type.</p><p>Accepted types are: <code>fn</code>, <code>mod</code>, <code>struct</code>, <code>enum</code>, <code>trait</code>, <code>type</code>, <code>macro</code>, and <code>const</code>.</p><p>Search functions by type signature (e.g., <code>vec -> usize</code> or <code>* -> vec</code>)</p><p>Search multiple things at once by splitting your query with comma (e.g., <code>str,u8</code> or <code>String,struct:Vec,test</code>)</p></div></div></aside><script>window.rootPath = "../../";window.currentCrate = "kernel_config";</script><script src="../../aliases.js"></script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>